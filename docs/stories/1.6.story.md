# Story 1.6: Basic Analytics and Monitoring Setup

## Status
Backlog

## Story

**As a** product manager,
**I want** comprehensive analytics and error tracking from day one,
**so that** I can monitor user behavior and system health.

## Acceptance Criteria

1. PostHog analytics integrated with user event tracking
2. Mixpanel configured for funnel analysis and user retention metrics
3. Sentry error tracking implemented for frontend and backend
4. Hotjar heatmaps and session recordings configured
5. Vercel Analytics enabled for Core Web Vitals monitoring
6. Privacy-compliant analytics with user consent management
7. Custom analytics dashboard for key metrics tracking
8. Error alerting and notification system configured

## Tasks / Subtasks

- [ ] **PostHog Analytics Integration** (AC: 1)
  - [ ] Install and configure PostHog provider in app
  - [ ] Create analytics service wrapper at apps/web/src/lib/analytics/posthog.ts
  - [ ] Implement page view tracking with Next.js App Router
  - [ ] Add event tracking for key user actions (button clicks, form submissions)
  - [ ] Track meeting-specific events (create, join, end)
  - [ ] Add user identification with Clerk user data
  - [ ] Implement custom properties for events (user role, meeting type)
  - [ ] Test PostHog event capture in development with mock mode

- [ ] **Mixpanel Integration** (AC: 2)
  - [ ] Install mixpanel-browser package
  - [ ] Create Mixpanel service wrapper at apps/web/src/lib/analytics/mixpanel.ts
  - [ ] Implement funnel tracking for user journey (signup â†’ first meeting)
  - [ ] Add retention cohort tracking with user segments
  - [ ] Track custom events with rich metadata
  - [ ] Implement user profile properties
  - [ ] Add A/B test variant tracking
  - [ ] Create analytics event type definitions in packages/shared/src/types/analytics.ts

- [ ] **Sentry Error Tracking Enhancement** (AC: 3)
  - [ ] Extend existing Sentry configuration for analytics integration
  - [ ] Add custom error contexts (user state, meeting state, device info)
  - [ ] Implement breadcrumb tracking for user actions
  - [ ] Configure source maps for production error debugging
  - [ ] Add performance monitoring for API routes
  - [ ] Create error grouping and fingerprinting rules
  - [ ] Implement error sampling to stay within free tier (10K errors/month)
  - [ ] Add release tracking with git commit SHA

- [ ] **Hotjar Heatmaps and Recordings** (AC: 4)
  - [ ] Install Hotjar tracking script
  - [ ] Configure Hotjar for dashboard page heatmaps
  - [ ] Enable session recordings for meeting creation flow
  - [ ] Add user attribute tracking (role, signup date)
  - [ ] Implement privacy controls (mask sensitive data)
  - [ ] Configure recording triggers for error scenarios
  - [ ] Set up feedback polls for key user actions
  - [ ] Test Hotjar in production-like environment

- [ ] **Vercel Analytics and Core Web Vitals** (AC: 5)
  - [ ] Enable Vercel Analytics in project settings
  - [ ] Install @vercel/analytics package
  - [ ] Add Analytics component to root layout
  - [ ] Configure Web Vitals tracking (LCP, FID, CLS, TTFB, FCP)
  - [ ] Create custom Web Vitals reporting function
  - [ ] Add route-specific performance tracking
  - [ ] Implement performance budget alerts
  - [ ] Create Core Web Vitals dashboard visualization

- [ ] **GDPR Cookie Consent Management** (AC: 6)
  - [ ] Install react-cookie-consent package
  - [ ] Create CookieConsent component at apps/web/src/components/common/CookieConsent.tsx
  - [ ] Implement consent banner with Accept/Decline options
  - [ ] Create consent preferences page with granular controls
  - [ ] Store user consent in localStorage and Supabase
  - [ ] Add consent gating for analytics scripts
  - [ ] Implement analytics opt-out functionality
  - [ ] Add GDPR data export and deletion workflows
  - [ ] Create privacy policy and cookie policy pages

- [ ] **Custom Analytics Dashboard** (AC: 7)
  - [ ] Create analytics dashboard page at apps/web/src/app/(dashboard)/analytics/page.tsx
  - [ ] Design dashboard layout with key metrics cards
  - [ ] Implement real-time user activity widget
  - [ ] Add daily/weekly/monthly metrics charts (Recharts)
  - [ ] Create user retention cohort visualization
  - [ ] Add meeting analytics (creation rate, duration, success rate)
  - [ ] Implement error rate and performance metrics display
  - [ ] Add export functionality for analytics data (CSV/PDF)
  - [ ] Create admin-only access control for analytics page

- [ ] **Error Alerting and Notifications** (AC: 8)
  - [ ] Configure Sentry alert rules for critical errors
  - [ ] Set up email notifications for high-severity errors
  - [ ] Integrate Slack webhook for real-time error alerts
  - [ ] Create error severity classification system
  - [ ] Implement error rate threshold alerts (>10 errors/min)
  - [ ] Add performance degradation alerts (API >500ms)
  - [ ] Configure uptime monitoring with status page
  - [ ] Create on-call escalation workflow

- [ ] **Analytics Service Layer** (AC: All)
  - [ ] Create unified analytics interface at apps/web/src/lib/analytics/index.ts
  - [ ] Implement analytics provider factory pattern
  - [ ] Add mock analytics service for development/testing
  - [ ] Create analytics event queue for batching
  - [ ] Implement retry logic for failed tracking
  - [ ] Add analytics health check and circuit breaker
  - [ ] Create analytics debugging tools
  - [ ] Document analytics integration guide

- [ ] **TypeScript Type Definitions** (AC: All)
  - [ ] Create packages/shared/src/types/analytics.ts
  - [ ] Define AnalyticsEvent interface with event types
  - [ ] Define UserProperties and EventProperties interfaces
  - [ ] Define ConsentPreferences interface
  - [ ] Define AnalyticsDashboardMetrics interface
  - [ ] Export all types from packages/shared/src/types/index.ts
  - [ ] Ensure strict type checking for all analytics code

- [ ] **Testing** (AC: All)
  - [ ] Create tests/lib/analytics/posthog.test.ts
  - [ ] Create tests/lib/analytics/mixpanel.test.ts
  - [ ] Create tests/components/common/CookieConsent.test.tsx
  - [ ] Create tests/pages/analytics.test.tsx
  - [ ] Test analytics event tracking with mock providers
  - [ ] Test consent management flow
  - [ ] Test error alerting with simulated errors
  - [ ] Test analytics dashboard data visualization
  - [ ] Manual testing: Verify analytics in browser DevTools
  - [ ] Manual testing: Verify Hotjar recordings capture correctly

## Dev Notes

### Previous Story Insights

[Source: Story 1.5 Dev Agent Record]

**Existing Infrastructure:**
- Sentry already installed and configured (@sentry/nextjs@^7.93.0)
- PostHog library installed (posthog-js@^1.100.0)
- Security monitoring system at apps/web/src/lib/security/monitoring.ts
- Service factory pattern at apps/web/src/lib/service-factory.ts
- Environment configuration at apps/web/src/lib/config/env.ts

**Integration Points:**
- Clerk authentication provides user identification
- Dashboard at apps/web/src/app/(dashboard)/dashboard/page.tsx
- Meeting creation flow with tracking opportunities
- Error boundaries for error tracking integration

### Analytics Architecture

[Source: PRD - Analytics & Monitoring Section]

**Analytics Stack:**
```typescript
interface AnalyticsStack {
  productAnalytics: 'PostHog';  // Feature usage, funnels
  advancedAnalytics: 'Mixpanel'; // Retention, cohorts
  errorTracking: 'Sentry';       // Already configured
  heatmaps: 'Hotjar';            // User behavior
  performance: 'Vercel Analytics'; // Core Web Vitals
}
```

**Event Tracking Strategy:**
```typescript
enum AnalyticsEvent {
  // User Journey
  USER_SIGNED_UP = 'user_signed_up',
  USER_SIGNED_IN = 'user_signed_in',
  USER_SIGNED_OUT = 'user_signed_out',

  // Meeting Events
  MEETING_CREATED = 'meeting_created',
  MEETING_JOINED = 'meeting_joined',
  MEETING_ENDED = 'meeting_ended',
  MEETING_RECORDING_STARTED = 'meeting_recording_started',

  // Feature Usage
  WHITEBOARD_OPENED = 'whiteboard_opened',
  FILE_SHARED = 'file_shared',
  SCREEN_SHARED = 'screen_shared',
  CHAT_MESSAGE_SENT = 'chat_message_sent',

  // Engagement
  SETTINGS_UPDATED = 'settings_updated',
  PROFILE_UPDATED = 'profile_updated',
  FEEDBACK_SUBMITTED = 'feedback_submitted',
}

interface AnalyticsEventPayload {
  event: AnalyticsEvent;
  userId?: string;
  properties?: Record<string, any>;
  timestamp: Date;
}
```

### Unified Analytics Service

**Service Interface:**
```typescript
// apps/web/src/lib/analytics/index.ts
export interface IAnalyticsService {
  // Initialization
  initialize(userId?: string): void;

  // User Management
  identify(userId: string, traits?: Record<string, any>): void;

  // Event Tracking
  track(event: string, properties?: Record<string, any>): void;
  page(name?: string, properties?: Record<string, any>): void;

  // Consent Management
  setConsent(hasConsent: boolean): void;

  // Error Tracking
  captureError(error: Error, context?: Record<string, any>): void;
}

// Unified analytics manager
export class AnalyticsManager implements IAnalyticsService {
  private providers: IAnalyticsService[] = [];
  private hasConsent: boolean = false;

  constructor() {
    // Initialize all providers based on environment
    if (this.shouldUseRealServices()) {
      this.providers.push(
        new PostHogService(),
        new MixpanelService(),
        new HotjarService(),
        new VercelAnalyticsService()
      );
    } else {
      this.providers.push(new MockAnalyticsService());
    }
  }

  track(event: string, properties?: Record<string, any>): void {
    if (!this.hasConsent) return; // Respect user consent

    this.providers.forEach(provider => {
      try {
        provider.track(event, properties);
      } catch (error) {
        console.error(`Analytics provider failed:`, error);
        // Don't let analytics failures break the app
      }
    });
  }

  // ... other methods
}

// Export singleton instance
export const analytics = new AnalyticsManager();
```

### PostHog Integration

**Configuration:**
```typescript
// apps/web/src/lib/analytics/posthog.ts
import posthog from 'posthog-js';

export class PostHogService implements IAnalyticsService {
  initialize(userId?: string): void {
    if (typeof window === 'undefined') return;

    posthog.init(process.env.NEXT_PUBLIC_POSTHOG_KEY!, {
      api_host: process.env.NEXT_PUBLIC_POSTHOG_HOST || 'https://app.posthog.com',
      loaded: (posthog) => {
        if (userId) {
          posthog.identify(userId);
        }
      },
      capture_pageview: true, // Automatic page view tracking
      capture_pageleave: true,
      autocapture: false, // We'll track events manually for better control
    });
  }

  track(event: string, properties?: Record<string, any>): void {
    posthog.capture(event, properties);
  }

  page(name?: string, properties?: Record<string, any>): void {
    posthog.capture('$pageview', { page: name, ...properties });
  }

  identify(userId: string, traits?: Record<string, any>): void {
    posthog.identify(userId, traits);
  }
}
```

### Mixpanel Integration

**Configuration:**
```typescript
// apps/web/src/lib/analytics/mixpanel.ts
import mixpanel from 'mixpanel-browser';

export class MixpanelService implements IAnalyticsService {
  initialize(userId?: string): void {
    mixpanel.init(process.env.NEXT_PUBLIC_MIXPANEL_TOKEN!, {
      debug: process.env.NODE_ENV === 'development',
      track_pageview: true,
      persistence: 'localStorage',
    });

    if (userId) {
      mixpanel.identify(userId);
    }
  }

  track(event: string, properties?: Record<string, any>): void {
    mixpanel.track(event, properties);
  }

  identify(userId: string, traits?: Record<string, any>): void {
    mixpanel.identify(userId);
    if (traits) {
      mixpanel.people.set(traits);
    }
  }

  // Mixpanel-specific methods
  trackFunnel(funnelName: string, step: number, properties?: Record<string, any>): void {
    mixpanel.track(`${funnelName} - Step ${step}`, properties);
  }

  trackRevenue(amount: number, properties?: Record<string, any>): void {
    mixpanel.people.track_charge(amount, properties);
  }
}
```

### Cookie Consent Banner

**UI Component:**
```typescript
// apps/web/src/components/common/CookieConsent.tsx
'use client';

import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';
import { analytics } from '@/lib/analytics';

interface ConsentPreferences {
  necessary: boolean;
  analytics: boolean;
  marketing: boolean;
}

export function CookieConsent() {
  const [showBanner, setShowBanner] = useState(false);
  const [preferences, setPreferences] = useState<ConsentPreferences>({
    necessary: true,
    analytics: false,
    marketing: false,
  });

  useEffect(() => {
    const consent = localStorage.getItem('cookie-consent');
    if (!consent) {
      setShowBanner(true);
    } else {
      const saved = JSON.parse(consent);
      setPreferences(saved);
      analytics.setConsent(saved.analytics);
    }
  }, []);

  const acceptAll = () => {
    const newPrefs = { necessary: true, analytics: true, marketing: true };
    saveConsent(newPrefs);
  };

  const acceptNecessary = () => {
    const newPrefs = { necessary: true, analytics: false, marketing: false };
    saveConsent(newPrefs);
  };

  const saveConsent = (prefs: ConsentPreferences) => {
    localStorage.setItem('cookie-consent', JSON.stringify(prefs));
    analytics.setConsent(prefs.analytics);
    setShowBanner(false);

    // Track consent decision
    analytics.track('cookie_consent_updated', prefs);
  };

  if (!showBanner) return null;

  return (
    <div className="fixed bottom-4 left-4 right-4 z-50 md:left-auto md:right-4 md:max-w-md">
      <Card className="p-6 shadow-lg">
        <h3 className="text-lg font-semibold mb-2">We value your privacy</h3>
        <p className="text-sm text-gray-600 mb-4">
          We use cookies to improve your experience, analyze site traffic, and personalize content.
        </p>
        <div className="flex gap-2">
          <Button onClick={acceptAll} className="flex-1">
            Accept All
          </Button>
          <Button onClick={acceptNecessary} variant="outline" className="flex-1">
            Necessary Only
          </Button>
        </div>
      </Card>
    </div>
  );
}
```

### Vercel Analytics Integration

**Setup:**
```typescript
// apps/web/src/app/layout.tsx (add to existing layout)
import { Analytics } from '@vercel/analytics/react';
import { SpeedInsights } from '@vercel/speed-insights/next';

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        {children}
        <Analytics />
        <SpeedInsights />
      </body>
    </html>
  );
}
```

**Custom Web Vitals Reporting:**
```typescript
// apps/web/src/lib/analytics/web-vitals.ts
import { onCLS, onFID, onLCP, onFCP, onTTFB } from 'web-vitals';
import { analytics } from '@/lib/analytics';

export function reportWebVitals() {
  onCLS((metric) => {
    analytics.track('web_vitals', {
      metric: 'CLS',
      value: metric.value,
      rating: metric.rating,
    });
  });

  onFID((metric) => {
    analytics.track('web_vitals', {
      metric: 'FID',
      value: metric.value,
      rating: metric.rating,
    });
  });

  onLCP((metric) => {
    analytics.track('web_vitals', {
      metric: 'LCP',
      value: metric.value,
      rating: metric.rating,
    });
  });

  onFCP((metric) => {
    analytics.track('web_vitals', {
      metric: 'FCP',
      value: metric.value,
      rating: metric.rating,
    });
  });

  onTTFB((metric) => {
    analytics.track('web_vitals', {
      metric: 'TTFB',
      value: metric.value,
      rating: metric.rating,
    });
  });
}
```

### Analytics Dashboard Design

**Dashboard Metrics:**
```typescript
// packages/shared/src/types/analytics.ts
export interface AnalyticsDashboardMetrics {
  userMetrics: {
    totalUsers: number;
    activeUsers: number;
    newUsers: number;
    retention: number;
  };
  meetingMetrics: {
    totalMeetings: number;
    averageDuration: number;
    successRate: number;
    recordedMeetings: number;
  };
  performanceMetrics: {
    averageLoadTime: number;
    errorRate: number;
    apiLatency: number;
    coreWebVitals: {
      lcp: number;
      fid: number;
      cls: number;
    };
  };
  engagementMetrics: {
    dailyActiveUsers: number;
    averageSessionDuration: number;
    featuresUsed: Record<string, number>;
  };
}
```

**Dashboard Component:**
```typescript
// apps/web/src/app/(dashboard)/analytics/page.tsx
'use client';

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { useQuery } from '@tanstack/react-query';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';

export default function AnalyticsPage() {
  const { data: metrics, isLoading } = useQuery({
    queryKey: ['analytics-metrics'],
    queryFn: () => fetch('/api/analytics/metrics').then(res => res.json()),
  });

  if (isLoading) return <div>Loading analytics...</div>;

  return (
    <div className="p-6">
      <h1 className="text-2xl font-bold mb-6">Analytics Dashboard</h1>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <Card>
          <CardHeader>
            <CardTitle>Total Users</CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-3xl font-bold">{metrics.userMetrics.totalUsers}</p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle>Active Users</CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-3xl font-bold">{metrics.userMetrics.activeUsers}</p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle>Total Meetings</CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-3xl font-bold">{metrics.meetingMetrics.totalMeetings}</p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle>Error Rate</CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-3xl font-bold">{metrics.performanceMetrics.errorRate}%</p>
          </CardContent>
        </Card>
      </div>

      {/* Charts and detailed metrics */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle>User Growth</CardTitle>
        </CardHeader>
        <CardContent>
          <ResponsiveContainer width="100%" height={300}>
            <BarChart data={metrics.userGrowth}>
              <CartesianGrid strokeDasharray="3 3" />
              <XAxis dataKey="date" />
              <YAxis />
              <Tooltip />
              <Bar dataKey="users" fill="#001F3F" />
            </BarChart>
          </ResponsiveContainer>
        </CardContent>
      </Card>
    </div>
  );
}
```

### Error Alerting Configuration

**Sentry Alert Rules:**
```typescript
// apps/web/src/lib/analytics/error-alerting.ts
import * as Sentry from '@sentry/nextjs';

export function configureErrorAlerting() {
  // Configure alert rules programmatically
  Sentry.configureScope((scope) => {
    // Set context for all errors
    scope.setContext('application', {
      name: 'MeetSolis',
      environment: process.env.NODE_ENV,
      version: process.env.NEXT_PUBLIC_APP_VERSION,
    });
  });

  // Custom error handler for critical errors
  Sentry.addGlobalEventProcessor((event, hint) => {
    const error = hint.originalException;

    if (error instanceof Error) {
      // Classify error severity
      const isCritical =
        error.message.includes('payment') ||
        error.message.includes('database') ||
        error.message.includes('authentication');

      if (isCritical) {
        event.level = 'fatal';

        // Trigger immediate alert (via webhook in Sentry settings)
        sendCriticalErrorAlert(error);
      }
    }

    return event;
  });
}

async function sendCriticalErrorAlert(error: Error) {
  // Send to Slack webhook
  if (process.env.SLACK_WEBHOOK_URL) {
    await fetch(process.env.SLACK_WEBHOOK_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        text: `ðŸš¨ Critical Error in MeetSolis`,
        blocks: [
          {
            type: 'section',
            text: {
              type: 'mrkdwn',
              text: `*Error:* ${error.message}\n*Stack:* \`\`\`${error.stack?.substring(0, 500)}\`\`\``,
            },
          },
        ],
      }),
    });
  }
}
```

### Environment Variables

**Required Environment Variables:**
```bash
# Analytics Services
NEXT_PUBLIC_POSTHOG_KEY=phc_xxxxxxxxxxxxxxxxxxxxx
NEXT_PUBLIC_POSTHOG_HOST=https://app.posthog.com

NEXT_PUBLIC_MIXPANEL_TOKEN=xxxxxxxxxxxxxxxxxxxxx

NEXT_PUBLIC_HOTJAR_ID=xxxxxxxxxxxxx
NEXT_PUBLIC_HOTJAR_SV=6

# Error Monitoring (already configured)
SENTRY_DSN=https://xxxxxxxxxxxxx@sentry.io/xxxxx
NEXT_PUBLIC_SENTRY_DSN=https://xxxxxxxxxxxxx@sentry.io/xxxxx

# Alerting
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/xxx/xxx/xxx

# Vercel Analytics (auto-enabled on Vercel)
# No env vars needed - enabled via Vercel dashboard
```

### Dependencies to Install

**New Packages:**
```json
{
  "dependencies": {
    "mixpanel-browser": "^2.49.0",
    "react-cookie-consent": "^9.0.0",
    "@vercel/analytics": "^1.1.1",
    "@vercel/speed-insights": "^1.0.2",
    "web-vitals": "^3.5.0"
  }
}
```

### Testing Strategy

**Mock Analytics Service:**
```typescript
// apps/web/src/lib/analytics/mock.ts
export class MockAnalyticsService implements IAnalyticsService {
  private events: Array<{ event: string; properties?: any }> = [];

  track(event: string, properties?: Record<string, any>): void {
    this.events.push({ event, properties });
    console.log('[MOCK ANALYTICS] Track:', event, properties);
  }

  identify(userId: string, traits?: Record<string, any>): void {
    console.log('[MOCK ANALYTICS] Identify:', userId, traits);
  }

  // Expose for testing
  getTrackedEvents() {
    return this.events;
  }

  clearEvents() {
    this.events = [];
  }
}
```

**Test Example:**
```typescript
// tests/lib/analytics/analytics.test.ts
import { AnalyticsManager } from '@/lib/analytics';

describe('AnalyticsManager', () => {
  let analytics: AnalyticsManager;

  beforeEach(() => {
    // Use mock service in tests
    process.env.USE_MOCK_SERVICES = 'true';
    analytics = new AnalyticsManager();
  });

  it('should track events when consent is given', () => {
    analytics.setConsent(true);
    analytics.track('test_event', { foo: 'bar' });

    const mockService = analytics['providers'][0] as MockAnalyticsService;
    const events = mockService.getTrackedEvents();

    expect(events).toHaveLength(1);
    expect(events[0].event).toBe('test_event');
  });

  it('should not track events without consent', () => {
    analytics.setConsent(false);
    analytics.track('test_event');

    const mockService = analytics['providers'][0] as MockAnalyticsService;
    const events = mockService.getTrackedEvents();

    expect(events).toHaveLength(0);
  });
});
```

### Performance Considerations

**Lazy Loading Analytics:**
```typescript
// apps/web/src/app/layout.tsx
'use client';

import { useEffect } from 'react';
import dynamic from 'next/dynamic';

// Lazy load analytics after page is interactive
const Analytics = dynamic(() => import('@/lib/analytics').then(mod => mod.Analytics), {
  ssr: false,
});

export default function RootLayout({ children }: { children: React.ReactNode }) {
  useEffect(() => {
    // Initialize analytics after page load
    if (typeof window !== 'undefined' && 'requestIdleCallback' in window) {
      requestIdleCallback(() => {
        import('@/lib/analytics').then(({ analytics }) => {
          analytics.initialize();
        });
      });
    }
  }, []);

  return (
    <html lang="en">
      <body>
        {children}
        <Analytics />
      </body>
    </html>
  );
}
```

### Cost Management

**Free Tier Limits:**
- **PostHog:** 1M events/month (community plan)
- **Mixpanel:** 100K MTU (monthly tracked users)
- **Sentry:** 5K errors/month (developer plan)
- **Hotjar:** 35 daily sessions (basic plan)
- **Vercel Analytics:** Included with Vercel Pro

**Usage Monitoring:**
```typescript
// apps/web/src/lib/analytics/usage-monitor.ts
export class UsageMonitor {
  private eventCount = 0;
  private readonly MONTHLY_LIMIT = 900000; // 90% of 1M to leave buffer

  canTrack(): boolean {
    return this.eventCount < this.MONTHLY_LIMIT;
  }

  incrementCount(): void {
    this.eventCount++;

    if (this.eventCount >= this.MONTHLY_LIMIT * 0.8) {
      console.warn('Analytics usage at 80% of monthly limit');
    }
  }

  async syncWithPostHog(): Promise<void> {
    // Fetch actual usage from PostHog API
    // Update eventCount based on real usage
  }
}
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-05 | 1.0 | Initial story creation for analytics and monitoring setup | Sarah (Product Owner) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results

*Results from QA Agent review will be populated here after story completion*
