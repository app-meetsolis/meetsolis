# Story 2.6: Client Detail View (Shell)

## Status

Draft

---

## Story

**As a** user,
**I want** to view detailed client information,
**so that** I can see all context for a specific client.

---

## Acceptance Criteria

1. Client detail page: `/clients/[id]`
2. Header: Back button, Client name, Role/Company, Tags
3. Action buttons: "Prepare for Meeting", "Edit", "Delete" (dropdown menu)
4. Tabbed interface: Overview, Meetings, Notes, Action Items
5. Overview tab (initial view): Client info, AI-generated overview (placeholder for Epic 4)
6. Meetings tab: Empty state ("No meetings yet. Log your first meeting.")
7. Notes tab: Rich text editor (manual notes) - implemented in Story 2.7
8. Action Items tab: Empty state ("No action items yet.")
9. 404 page if client not found
10. Access control: User can only view their own clients

---

## Tasks / Subtasks

- [ ] **Task 1: Client Detail Page** (AC: 1, 9, 10)
  - [ ] Create `apps/web/src/app/clients/[id]/page.tsx`
  - [ ] Add page metadata (dynamic title: `{Client Name} | MeetSolis`)
  - [ ] Fetch client data: `GET /api/clients/[id]`
  - [ ] Handle loading state (skeleton)
  - [ ] Handle 404: Client not found or doesn't belong to user
  - [ ] Handle error state
  - [ ] Protect route (middleware ensures auth)

- [ ] **Task 2: Client Detail Header** (AC: 2, 3)
  - [ ] Create `apps/web/src/components/clients/ClientDetailHeader.tsx`
  - [ ] Display back button (← icon) → navigate to `/clients`
  - [ ] Display client name (large, bold)
  - [ ] Display role/company below name (gray, smaller)
  - [ ] Display tags as TagPill components (from Story 2.5)
  - [ ] Add action buttons (top-right):
    - "Prepare for Meeting" button (primary, links to Epic 3 feature)
    - Dropdown menu with "Edit" and "Delete" options

- [ ] **Task 3: Tabbed Interface** (AC: 4)
  - [ ] Create `apps/web/src/components/clients/ClientTabs.tsx`
  - [ ] Use Shadcn Tabs component
  - [ ] Tabs: "Overview", "Meetings", "Notes", "Action Items"
  - [ ] Default active tab: "Overview"
  - [ ] URL should reflect active tab: `/clients/[id]?tab=overview`
  - [ ] Tab content changes based on active tab

- [ ] **Task 4: Overview Tab** (AC: 5)
  - [ ] Create `apps/web/src/components/clients/ClientOverview.tsx`
  - [ ] Display client information:
    - Name, Company, Role
    - Email, Phone (with mailto/tel links)
    - Website (with external link icon)
    - LinkedIn URL (with external link icon)
    - Tags
    - Created date, Last updated date
  - [ ] Add placeholder for AI-generated overview:
    - Empty state: "AI overview will be generated after your first meeting." (grayed out)
    - Future: Will be populated in Epic 4

- [ ] **Task 5: Meetings Tab Empty State** (AC: 6)
  - [ ] Create `apps/web/src/components/clients/MeetingsTabEmpty.tsx`
  - [ ] Display empty state when no meetings exist for client
  - [ ] Message: "No meetings yet. Log your first meeting."
  - [ ] Add "+ Log Meeting" button (links to Epic 3 feature - placeholder for now)
  - [ ] Add illustration/icon (optional)

- [ ] **Task 6: Action Items Tab Empty State** (AC: 8)
  - [ ] Create `apps/web/src/components/clients/ActionItemsTabEmpty.tsx`
  - [ ] Display empty state when no action items exist for client
  - [ ] Message: "No action items yet."
  - [ ] Note: "Action items will appear here after logging meetings." (Epic 3)

- [ ] **Task 7: Edit Client Integration** (AC: 3)
  - [ ] Add "Edit" option in dropdown menu
  - [ ] onClick → Open ClientModal in edit mode (Story 2.3)
  - [ ] Pass current client data to modal
  - [ ] After save, refetch client data to update view

- [ ] **Task 8: Delete Client Integration** (AC: 3)
  - [ ] Add "Delete" option in dropdown menu
  - [ ] onClick → Open confirmation dialog (implemented in Story 2.8)
  - [ ] After delete, redirect to `/clients` dashboard

- [ ] **Task 9: Loading & Error States** (AC: 1)
  - [ ] Create loading skeleton for client detail page
  - [ ] Skeleton should match layout (header + tabs)
  - [ ] Error state component for failed client fetch
  - [ ] 404 state component for client not found

- [ ] **Task 10: Component Tests**
  - [ ] Test client detail page renders with client data
  - [ ] Test 404 handling (client not found)
  - [ ] Test access control (user can't view other user's client)
  - [ ] Test tab switching
  - [ ] Test back button navigation
  - [ ] Test edit/delete dropdown menu
  - [ ] Test empty states (meetings, action items)

---

## Dev Notes

### Relevant Architecture

**Page Structure:**
```
/clients/[id]
  ├── ClientDetailHeader (back, name, role, tags, actions)
  ├── ClientTabs (overview, meetings, notes, action items)
  │   ├── ClientOverview (client info, AI placeholder)
  │   ├── MeetingsTab (empty state for now)
  │   ├── NotesTab (implemented in Story 2.7)
  │   └── ActionItemsTab (empty state for now)
```

**API Integration:**
- GET /api/clients/[id] → Returns client object or 404
- RLS ensures user can only access their own clients
- If client.user_id !== auth.uid(), returns 404

**Component Library:**
- Shadcn Tabs for tabbed interface
- Shadcn DropdownMenu for Edit/Delete actions
- Shadcn Button for "Prepare for Meeting", "Edit", etc.
- Lucide icons: ArrowLeft (back), ExternalLink, MoreVertical (dropdown)

**URL Query Params:**
```typescript
// Read active tab from URL
const searchParams = useSearchParams();
const activeTab = searchParams.get('tab') || 'overview';

// Update URL on tab change
const router = useRouter();
router.push(`/clients/${clientId}?tab=${newTab}`);
```

**Source Tree:**
- Page: `apps/web/src/app/clients/[id]/page.tsx`
- Components: `apps/web/src/components/clients/`
  - `ClientDetailHeader.tsx`
  - `ClientTabs.tsx`
  - `ClientOverview.tsx`
  - `MeetingsTabEmpty.tsx`
  - `ActionItemsTabEmpty.tsx`

**Important Notes:**
- Story 2.7 will implement the Notes tab (rich text editor)
- Story 2.8 will implement the Delete confirmation dialog
- Epic 3 will populate the Meetings tab
- Epic 3 will populate the Action Items tab
- Epic 4 will populate the AI overview placeholder

### Testing

**Test Location:**
- Page tests: `apps/web/src/app/clients/[id]/__tests__/`
- Component tests: `apps/web/src/components/clients/__tests__/`

**Testing Standards:**
- Use Jest + Testing Library
- Mock Next.js router (useParams, useSearchParams)
- Mock API fetch for client data

**Specific Requirements:**
- Test 404 handling (client not found)
- Test access control (RLS enforcement)
- Test tab switching (URL params)
- Test back button navigation
- Test edit/delete actions
- Test empty states

**Example Test Pattern:**
```typescript
import { render, screen } from '@testing-library/react';
import ClientDetailPage from '../page';

jest.mock('next/navigation', () => ({
  useParams: () => ({ id: 'client-123' }),
  useSearchParams: () => new URLSearchParams({ tab: 'overview' }),
}));

test('renders client detail page', async () => {
  const client = { id: 'client-123', name: 'Acme Corp', role: 'CEO' };

  global.fetch = jest.fn(() =>
    Promise.resolve({ json: () => Promise.resolve(client) })
  );

  render(<ClientDetailPage />);

  expect(await screen.findByText('Acme Corp')).toBeInTheDocument();
  expect(screen.getByText('CEO')).toBeInTheDocument();
});
```

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-07 | 1.0 | Initial story creation | Sarah (PO) |

---

## Dev Agent Record

*This section will be populated by the development agent during implementation.*

---

## QA Results

*This section will be populated by the QA agent after story completion.*
