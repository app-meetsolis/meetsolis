# Story 1.5: Basic Dashboard with Meeting Management

## Status
Approved

## Story

**As a** freelancer,
**I want** a clean dashboard where I can see my meetings and access core features,
**so that** I can efficiently manage my client calls.

## Acceptance Criteria

1. Dashboard page created with Shadcn UI components and responsive design
2. Meeting history display with search and filter capabilities
3. Quick meeting creation button with immediate meeting room generation
4. User profile section with basic settings and role display
5. Navigation menu with keyboard shortcuts (React-Hotkeys)
6. Meeting performance metrics preview (preparing for Epic 4)
7. Real-time updates for meeting status using Supabase Realtime
8. Accessibility compliance (WCAG 2.1 AA) with react-axe testing
9. Loading states and error handling with proper user feedback

## Tasks / Subtasks

- [ ] **Dashboard Page Layout and Structure** (AC: 1, 8)
  - [ ] Create dashboard page at apps/web/src/app/(dashboard)/dashboard/page.tsx
  - [ ] Create dashboard layout at apps/web/src/app/(dashboard)/layout.tsx with navigation
  - [ ] Implement responsive grid layout using Tailwind CSS and Shadcn UI Card components
  - [ ] Add loading states with Shadcn Skeleton components
  - [ ] Implement ErrorBoundary component for dashboard error handling
  - [ ] Add react-axe for accessibility testing in development mode
  - [ ] Test responsive design on mobile, tablet, and desktop breakpoints

- [ ] **User Profile Section** (AC: 4)
  - [ ] Create UserProfile component at apps/web/src/components/dashboard/UserProfile.tsx
  - [ ] Fetch current user data using Clerk useUser() hook
  - [ ] Display user name, email, role, and avatar using Shadcn Avatar component
  - [ ] Add user preferences display (theme, default audio/video settings)
  - [ ] Implement profile dropdown menu with settings and sign-out options
  - [ ] Add TypeScript interfaces for UserProfile props in packages/shared/src/types/dashboard.ts

- [ ] **Meeting History Display with Search and Filter** (AC: 2, 7)
  - [ ] Create MeetingHistory component at apps/web/src/components/dashboard/MeetingHistory.tsx
  - [ ] Create API route GET /api/meetings at apps/web/src/app/api/meetings/route.ts
  - [ ] Implement Supabase query to fetch user's meetings (as host or participant) with RLS
  - [ ] Use @tanstack/react-query for data fetching and caching
  - [ ] Display meetings in Shadcn Table or Card grid with status badges
  - [ ] Implement search functionality using Shadcn Input with debounced search
  - [ ] Add filter dropdowns for meeting status (scheduled, active, ended) using Shadcn Select
  - [ ] Implement date range filter using date-fns and Shadcn Calendar
  - [ ] Add Supabase Realtime subscription for live meeting status updates
  - [ ] Handle empty states with appropriate messaging and illustrations

- [ ] **Quick Meeting Creation** (AC: 3)
  - [ ] Create CreateMeetingButton component at apps/web/src/components/dashboard/CreateMeetingButton.tsx
  - [ ] Add prominent "Start Meeting" button in dashboard header using Shadcn Button
  - [ ] Create API route POST /api/meetings at apps/web/src/app/api/meetings/route.ts
  - [ ] Implement meeting creation logic with Supabase insert
  - [ ] Generate unique invite_link using nanoid or similar library
  - [ ] Set default meeting settings from architecture (allow_screen_share: true, etc.)
  - [ ] Show loading spinner during meeting creation using Shadcn Button loading state
  - [ ] Display toast notification on success/failure using React-Toastify
  - [ ] Redirect user to meeting room page after creation (/meeting/[id])
  - [ ] Add quick meeting modal with optional title/description using Shadcn Dialog

- [ ] **Navigation Menu with Keyboard Shortcuts** (AC: 5)
  - [ ] Create Navigation component at apps/web/src/components/dashboard/Navigation.tsx
  - [ ] Implement navigation menu with Dashboard, Meetings, Settings links
  - [ ] Add react-hotkeys-hook for keyboard shortcuts
  - [ ] Implement keyboard shortcuts: Ctrl+D (Dashboard), Ctrl+N (New Meeting), Ctrl+M (Meetings)
  - [ ] Display keyboard shortcut hints in navigation tooltips using Shadcn Tooltip
  - [ ] Add mobile-responsive navigation with hamburger menu for small screens
  - [ ] Highlight active route using Next.js usePathname hook

- [ ] **Meeting Performance Metrics Preview** (AC: 6)
  - [ ] Create MetricsPreview component at apps/web/src/components/dashboard/MetricsPreview.tsx
  - [ ] Display placeholder metrics: Total Meetings, Meeting Hours, Average Duration
  - [ ] Use Shadcn Card components for metrics display
  - [ ] Add mock data for metrics (actual data from Epic 4 analytics)
  - [ ] Implement simple bar chart or stats display using Recharts (lightweight)
  - [ ] Add loading states and skeleton loaders

- [ ] **Real-time Meeting Status Updates** (AC: 7)
  - [ ] Create useMeetingRealtime hook at apps/web/src/hooks/useMeetingRealtime.ts
  - [ ] Subscribe to Supabase Realtime channel for meetings table changes
  - [ ] Listen for INSERT, UPDATE, DELETE events on meetings table
  - [ ] Update react-query cache when Realtime events received
  - [ ] Handle Realtime connection errors with retry logic
  - [ ] Add connection status indicator in dashboard header
  - [ ] Unsubscribe from Realtime channels on component unmount

- [ ] **API Service Layer for Meetings** (AC: 1, 2, 3)
  - [ ] Create meetings service at apps/web/src/services/meetings.ts
  - [ ] Implement createMeeting(data: CreateMeetingInput): Promise<Meeting>
  - [ ] Implement getMeetings(filters?: MeetingFilters): Promise<Meeting[]>
  - [ ] Implement getMeetingById(id: string): Promise<Meeting>
  - [ ] Use centralized API client from apps/web/src/lib/api-client.ts
  - [ ] Add error handling and toast notifications for all service methods
  - [ ] Define TypeScript interfaces in packages/shared/src/types/meeting.ts

- [ ] **TypeScript Type Definitions** (AC: All)
  - [ ] Create packages/shared/src/types/dashboard.ts for dashboard types
  - [ ] Define Meeting, MeetingSettings, MeetingFilters interfaces
  - [ ] Define CreateMeetingInput, UpdateMeetingInput interfaces
  - [ ] Export all types from packages/shared/src/types/index.ts
  - [ ] Ensure strict type checking for all components and API routes

- [ ] **Testing** (AC: 8, 9)
  - [ ] Create tests/pages/dashboard.test.tsx for dashboard page tests
  - [ ] Create tests/components/dashboard/MeetingHistory.test.tsx
  - [ ] Create tests/components/dashboard/CreateMeetingButton.test.tsx
  - [ ] Create tests/api/meetings/route.test.ts for API route tests
  - [ ] Test accessibility with react-axe in development
  - [ ] Test keyboard navigation and shortcuts
  - [ ] Test Realtime subscription and updates
  - [ ] Test error handling and loading states
  - [ ] Test responsive design with different viewport sizes

## Dev Notes

### Previous Story Insights

[Source: Story 1.4 Dev Agent Record]

**Database Structure:**
- Users table with clerk_id sync operational
- Meetings table with host_id, status, settings JSONB field
- Participants table (junction) for many-to-many relationship
- RLS policies enabled for multi-tenant security
- Supabase Realtime enabled for meetings, participants, messages tables

**Existing Infrastructure:**
- Clerk authentication fully functional at apps/web/src/app/(auth)/
- Protected routes middleware at apps/web/src/middleware.ts
- Supabase client utilities at apps/web/src/lib/supabase/
- API client with auth at apps/web/src/lib/api-client.ts
- Security headers and rate limiting configured

**Critical Integration Point:**
- Use existing Supabase client utilities from lib/supabase/client.ts for client-side queries
- Use lib/supabase/server.ts for API route queries with service role key
- Leverage RLS policies for automatic multi-tenant isolation
- User authentication via Clerk is already protecting routes

### UI/UX Wireframes and Design Specifications

[Source: docs/front-end-spec.md#dashboard-hub-epic-1-core-screen]

**Dashboard Layout Wireframe (Lines 304-318):**

```
┌─ Header (60px height) ──────────────────────────────────┐
│ [Logo] [Search Bar]           [Notifications] [Profile] │
├─ Main Content (12-col grid) ───────────────────────────┤
│ ┌─ Quick Actions (4 cols) ─┐ ┌─ Upcoming (4 cols) ────┐ │
│ │ [Start Call - Primary]   │ │ Next Call: Client A    │ │
│ │ [Schedule - Secondary]   │ │ 2:30 PM (in 15 min)   │ │
│ │ [Join - Tertiary]       │ │ [Join] [Prep] [Notes]  │ │
│ └─────────────────────────┘ └─ [2 more upcoming] ────┘ │
│ ┌─ Recent Activity (8 cols) ──────┐ ┌─ Wellness (4) ─┐ │
│ │ Call with Client B - Summary    │ │ 🟢 Healthy    │ │
│ │ Shared: proposal.pdf            │ │ 12 calls/week  │ │
│ │ AI Todo: Follow up on scope     │ │ Suggest break  │ │
│ └─────────────────────────────────┘ └───────────────┘ │
└─────────────────────────────────────────────────────────┘
```

**Key Dashboard Design Elements:**
- **12-column responsive grid** for flexible layout using Tailwind CSS Grid
- **Header:** 60px height with logo (left), search bar (center), notifications bell + profile avatar (right)
- **Quick Actions Panel:** 4-column section with three prominent CTA buttons
  - "Start Instant Call" (Primary button - Navy #001F3F)
  - "Schedule Meeting" (Secondary button - Navy outline)
  - "Join Meeting" (Tertiary button - Text with teal hover)
- **Upcoming Calls Card:** 4-column section displaying next 3 scheduled meetings
  - Client name, scheduled time with countdown ("in 15 minutes")
  - Action buttons: [Join] [Prep] [Notes]
  - Visual hierarchy with starting-soon meetings highlighted
- **Recent Activity Feed:** 8-column section showing:
  - Call history with client names
  - Shared files with document icons
  - AI-generated action items
  - Visual timeline with timestamps
- **Wellness Widget:** 4-column health indicator
  - Traffic light status (🟢 Healthy, 🟡 Warning, 🔴 Alert)
  - Weekly call volume tracking
  - Break suggestions for burnout prevention

**Component Specifications:**

[Source: docs/front-end-spec.md#component-library]

**MeetingCard Component:**
- **Variants:**
  - Upcoming: Next scheduled meetings with join capability
  - Past: Historical meetings with summary access
  - Starting Soon: Countdown timer with prominent join button (yellow border, pulse animation)
  - Archived: Reduced opacity with restore option
- **Visual Design:**
  - Consistent padding: 24px (LG from spacing scale)
  - Corner radius: 8px for premium feel
  - Shadow: Subtle shadow with hover lift effect (scale 1.02, 300ms ease)
  - Time formatting: Relative ("in 15 minutes", "2 days ago")
- **Interaction Patterns:**
  - Hover reveals additional context (meeting notes preview, client contact info)
  - One primary action per card to prevent decision paralysis
  - Click card to expand full details
  - Quick actions appear on hover (Edit, Delete, Duplicate)

**Button Component Specifications:**
- **Primary Button:** Deep navy (#001F3F) background, white text, 48px min height
- **Secondary Button:** Navy outline, white background, navy text
- **Tertiary Button:** Text-only with soft teal (#00A0B0) hover effect
- **States:**
  - Hover: Scale 1.02 with 300ms ease transition
  - Active: Inset shadow for pressed state
  - Loading: Spinner animation with disabled interaction
  - Disabled: 40% opacity with cursor not-allowed
- **Accessibility:** Minimum 48px touch target for mobile, ARIA labels required

**Navigation Component:**
- **Primary Navigation:** Persistent sidebar (desktop) with icons + text labels
  - Dashboard (home icon)
  - Meetings (video icon)
  - Tools (grid icon)
  - Analytics (chart icon)
  - Settings (gear icon)
- **Mobile Navigation:** Hamburger menu with slide-out drawer, bottom tab bar for primary actions
- **Keyboard Shortcuts:**
  - Ctrl+D: Dashboard
  - Ctrl+N: New Meeting
  - Ctrl+M: Meetings list
  - Display shortcut hints in tooltips (Shadcn Tooltip component)

**Design System Guidelines:**

[Source: docs/front-end-spec.md#branding-style-guide]

**Color Palette:**
- **Primary:** #001F3F (Deep Navy) - Headers, primary CTAs, brand elements
- **Accent:** #00A0B0 (Soft Teal) - Interactive elements, hover effects, progress indicators
- **Success:** #10B981 (Emerald) - Positive feedback, call quality indicators
- **Warning:** #F59E0B (Amber) - Caution states, timer warnings
- **Error:** #EF4444 (Red) - Error states, destructive actions
- **Neutral:** #6B7280 (Mid Gray), #F3F4F6 (Light Gray), #374151 (Dark Gray)

**Typography:**
- **Font Family:** Inter (web font) with system font stack fallback
- **H1:** 32px / 2rem, 700 weight, 1.2 line-height (page titles)
- **H2:** 24px / 1.5rem, 600 weight, 1.3 line-height (section headers)
- **H3:** 20px / 1.25rem, 600 weight, 1.4 line-height (card titles)
- **Body:** 16px / 1rem, 400 weight, 1.5 line-height (standard text)
- **Small:** 14px / 0.875rem, 400 weight, 1.4 line-height (metadata, captions)

**Spacing Scale (8px baseline):**
- **XS:** 4px - Icon margins, fine adjustments
- **SM:** 8px - Tight spacing, form elements
- **MD:** 16px - Standard element spacing
- **LG:** 24px - Card padding, section spacing
- **XL:** 32px - Major section separation
- **XXL:** 48px - Page-level spacing

**Iconography:**
- **Library:** Lucide React icons as primary set
- **Size:** 24px standard for UI icons, 16px for inline text icons
- **Stroke width:** 2px for consistency
- **Pairing:** Always paired with text labels for accessibility (ARIA)

**Responsive Breakpoints:**
- **Mobile:** 320px - 767px (single-column stack, bottom sheet modals)
- **Tablet:** 768px - 1023px (two-column grid, slide-out sidebar)
- **Desktop:** 1024px - 1439px (three-column layout, persistent sidebar)
- **Wide:** 1440px+ (expanded sidebar, multi-panel workflows)

**Accessibility Requirements:**

[Source: docs/front-end-spec.md#accessibility-requirements]

- **WCAG 2.1 AA Compliance Target**
- **Color contrast ratios:** 4.5:1 minimum for normal text, 3:1 for large text (18pt+)
- **Focus indicators:** 2px solid teal (#00A0B0) outline with 2px offset on all interactive elements
- **Keyboard navigation:** Full tab order through all elements, escape key to close modals
- **Screen reader support:** ARIA labels, live regions for dynamic content (meeting status updates)
- **Touch targets:** 48px minimum for all interactive elements
- **Alternative text:** Descriptive alt text for all images, semantic HTML hierarchy
- **react-axe integration:** Automated accessibility testing in development mode

**Animation Guidelines:**
- **Interface transitions:** 300ms duration, cubic-bezier(0.4, 0.0, 0.2, 1) easing
- **Modal appearance:** 200ms scale and fade-in from center, ease-out
- **Card hover:** 150ms lift with shadow increase, ease-out
- **Button press:** 100ms scale down and back, ease-out
- **Loading states:** Skeleton screens with shimmer effect (1500ms, linear, infinite)
- **Performance target:** Maintain 60fps for all animations

**Implementation Notes:**
- Use Shadcn UI components as foundation (Button, Card, Input, Select, Table, Avatar, Skeleton, Dialog, Tooltip)
- Follow the MeetSolis design system for customization (navy/teal color scheme)
- Implement responsive grid using Tailwind CSS 12-column system
- Apply consistent spacing using the 8px baseline scale
- Ensure all components meet WCAG 2.1 AA accessibility standards
- Use Framer Motion for smooth animations where needed
- Test with react-axe during development for accessibility compliance

### Data Models and Database Schema

[Source: docs/architecture/data-models.md + database-schema.md]

**Meeting Interface:**
```typescript
interface Meeting {
  id: string;
  host_id: string;
  title: string;
  description?: string;
  status: 'scheduled' | 'active' | 'ended';
  scheduled_start?: string;
  actual_start?: string;
  actual_end?: string;
  settings: MeetingSettings;
  invite_link: string;
  waiting_room_enabled: boolean;
  locked: boolean;
  max_participants: number;
  created_at: string;
  updated_at: string;
}

interface MeetingSettings {
  allow_screen_share: boolean;
  allow_whiteboard: boolean;
  allow_file_upload: boolean;
  auto_record: boolean;
  enable_reactions: boolean;
  enable_polls: boolean;
  background_blur_default: boolean;
}
```

**Database Queries for Dashboard:**

```typescript
// Get user's meetings (as host)
const { data: meetings, error } = await supabase
  .from('meetings')
  .select('*')
  .eq('host_id', userId)
  .order('created_at', { ascending: false });

// Get user's meetings (as participant)
const { data: participatingMeetings, error } = await supabase
  .from('meetings')
  .select('*, participants!inner(user_id)')
  .eq('participants.user_id', userId)
  .order('created_at', { ascending: false });

// Create new meeting
const { data: newMeeting, error } = await supabase
  .from('meetings')
  .insert({
    host_id: userId,
    title: title,
    description: description,
    status: 'scheduled',
    invite_link: generateInviteLink(),
    settings: defaultMeetingSettings,
  })
  .select()
  .single();
```

**RLS Security:** All queries automatically filtered by RLS policies to show only authorized meetings.

### Frontend Architecture and Component Structure

[Source: docs/architecture/frontend-architecture.md + components.md]

**Dashboard Component Organization:**
```
apps/web/src/
├── app/
│   ├── (dashboard)/
│   │   ├── dashboard/
│   │   │   └── page.tsx              # Main dashboard page
│   │   └── layout.tsx                # Dashboard layout with nav
│   └── api/
│       └── meetings/
│           ├── route.ts              # GET/POST meetings
│           └── [id]/
│               └── route.ts          # GET/PATCH specific meeting
├── components/
│   ├── dashboard/
│   │   ├── MeetingHistory.tsx       # Meeting list with search/filter
│   │   ├── CreateMeetingButton.tsx  # Quick meeting creation
│   │   ├── UserProfile.tsx          # User info and settings
│   │   ├── Navigation.tsx           # Navigation menu
│   │   └── MetricsPreview.tsx       # Performance metrics
│   ├── common/
│   │   ├── LoadingSpinner.tsx       # Reusable loading state
│   │   └── ErrorBoundary.tsx        # Error handling wrapper
│   └── ui/                          # Shadcn UI components
├── hooks/
│   ├── useMeetings.ts               # React Query hook for meetings
│   └── useMeetingRealtime.ts       # Realtime subscription hook
└── services/
    └── meetings.ts                  # Meeting API service layer
```

**Component Template Pattern:**
```typescript
import React, { useState } from 'react';
import { useQuery } from '@tanstack/react-query';
import { toast } from 'react-toastify';
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';

interface ComponentProps {
  meetingId?: string;
  className?: string;
}

export const DashboardComponent: React.FC<ComponentProps> = ({
  meetingId,
  className
}) => {
  // React Query for data fetching
  const { data, error, isLoading } = useQuery({
    queryKey: ['meetings', meetingId],
    queryFn: () => fetchMeetings(),
    onError: (error) => {
      toast.error('Failed to load meetings');
    }
  });

  if (isLoading) return <LoadingSpinner />;
  if (error) return <ErrorState />;

  return (
    <Card className={className}>
      {/* Component content */}
    </Card>
  );
};
```

### API Architecture and Backend Patterns

[Source: docs/architecture/backend-architecture.md + api-specification.md]

**API Route Template (Edge Function):**
```typescript
// app/api/meetings/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { auth } from '@clerk/nextjs';
import { createClient } from '@supabase/supabase-js';
import { z } from 'zod';

// Request validation schema
const CreateMeetingSchema = z.object({
  title: z.string().min(1).max(200),
  description: z.string().optional(),
  scheduled_start: z.string().optional(),
});

// POST /api/meetings - Create new meeting
export async function POST(request: NextRequest) {
  try {
    // 1. Authentication
    const { userId } = auth();
    if (!userId) {
      return NextResponse.json(
        { error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },
        { status: 401 }
      );
    }

    // 2. Parse and validate request body
    const body = await request.json();
    const validation = CreateMeetingSchema.safeParse(body);
    if (!validation.success) {
      return NextResponse.json(
        { error: { code: 'INVALID_INPUT', message: validation.error.message } },
        { status: 400 }
      );
    }

    // 3. Database operation with service role key
    const supabase = createClient(
      process.env.NEXT_PUBLIC_SUPABASE_URL!,
      process.env.SUPABASE_SERVICE_ROLE_KEY!
    );

    // Get user's database ID from clerk_id
    const { data: user } = await supabase
      .from('users')
      .select('id')
      .eq('clerk_id', userId)
      .single();

    if (!user) {
      return NextResponse.json(
        { error: { code: 'USER_NOT_FOUND', message: 'User not found' } },
        { status: 404 }
      );
    }

    // 4. Insert meeting record
    const { data: meeting, error } = await supabase
      .from('meetings')
      .insert({
        host_id: user.id,
        title: validation.data.title,
        description: validation.data.description,
        status: 'scheduled',
        invite_link: generateInviteLink(),
        settings: {
          allow_screen_share: true,
          allow_whiteboard: true,
          allow_file_upload: true,
          auto_record: false,
          enable_reactions: true,
          enable_polls: true,
          background_blur_default: false,
        },
      })
      .select()
      .single();

    if (error) {
      throw error;
    }

    return NextResponse.json(meeting, { status: 201 });
  } catch (error) {
    console.error('API Error:', error);
    return NextResponse.json(
      { error: { code: 'INTERNAL_ERROR', message: 'Internal server error' } },
      { status: 500 }
    );
  }
}

// GET /api/meetings - Get user's meetings
export async function GET(request: NextRequest) {
  try {
    const { userId } = auth();
    if (!userId) {
      return NextResponse.json(
        { error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },
        { status: 401 }
      );
    }

    const supabase = createClient(
      process.env.NEXT_PUBLIC_SUPABASE_URL!,
      process.env.SUPABASE_SERVICE_ROLE_KEY!
    );

    // Get user's database ID
    const { data: user } = await supabase
      .from('users')
      .select('id')
      .eq('clerk_id', userId)
      .single();

    // Fetch meetings where user is host or participant (RLS handles security)
    const { data: meetings, error } = await supabase
      .from('meetings')
      .select('*, participants!inner(user_id)')
      .or(`host_id.eq.${user.id},participants.user_id.eq.${user.id}`)
      .order('created_at', { ascending: false });

    if (error) throw error;

    return NextResponse.json(meetings);
  } catch (error) {
    console.error('API Error:', error);
    return NextResponse.json(
      { error: { code: 'INTERNAL_ERROR', message: 'Internal server error' } },
      { status: 500 }
    );
  }
}

// Helper function to generate unique invite link
function generateInviteLink(): string {
  const { nanoid } = require('nanoid');
  return `${process.env.NEXT_PUBLIC_APP_URL}/meeting/${nanoid(10)}`;
}
```

### State Management with React Query

[Source: docs/architecture/frontend-architecture.md]

**React Query Setup for Meetings:**
```typescript
// hooks/useMeetings.ts
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { useApiClient } from '@/lib/api-client';
import { toast } from 'react-toastify';

export const useMeetings = () => {
  const apiClient = useApiClient();
  const queryClient = useQueryClient();

  // Fetch meetings
  const { data: meetings, isLoading, error } = useQuery({
    queryKey: ['meetings'],
    queryFn: () => apiClient.get('/meetings'),
    staleTime: 30000, // 30 seconds
  });

  // Create meeting mutation
  const createMeetingMutation = useMutation({
    mutationFn: (data: CreateMeetingInput) => apiClient.post('/meetings', data),
    onSuccess: (newMeeting) => {
      queryClient.invalidateQueries({ queryKey: ['meetings'] });
      toast.success('Meeting created successfully!');
    },
    onError: (error) => {
      toast.error('Failed to create meeting');
    },
  });

  return {
    meetings,
    isLoading,
    error,
    createMeeting: createMeetingMutation.mutate,
    isCreating: createMeetingMutation.isLoading,
  };
};
```

### Realtime Integration for Live Updates

[Source: docs/architecture/database-schema.md + Story 1.4]

**Realtime Subscription Pattern:**
```typescript
// hooks/useMeetingRealtime.ts
import { useEffect } from 'react';
import { useQueryClient } from '@tanstack/react-query';
import { getSupabaseClient } from '@/lib/supabase/client';

export const useMeetingRealtime = () => {
  const queryClient = useQueryClient();
  const supabase = getSupabaseClient();

  useEffect(() => {
    // Subscribe to meetings table changes
    const channel = supabase
      .channel('meetings-changes')
      .on(
        'postgres_changes',
        {
          event: '*', // Listen to all events (INSERT, UPDATE, DELETE)
          schema: 'public',
          table: 'meetings',
        },
        (payload) => {
          // Invalidate react-query cache to refetch meetings
          queryClient.invalidateQueries({ queryKey: ['meetings'] });
        }
      )
      .subscribe();

    // Cleanup subscription on unmount
    return () => {
      supabase.removeChannel(channel);
    };
  }, [supabase, queryClient]);
};
```

### Technology Stack Requirements

[Source: docs/architecture/tech-stack.md]

**Dashboard Dependencies:**
- **@tanstack/react-query**: ^5.17.0 - Data fetching and caching
- **react-toastify**: ^9.1.3 - Toast notifications
- **react-hotkeys-hook**: ^4.4.1 - Keyboard shortcuts
- **date-fns**: ^3.2.0 - Date manipulation for filters
- **nanoid**: ^5.0.4 - Unique ID generation for invite links
- **zod**: ^3.22.4 - Request validation in API routes
- **react-axe**: ^3.6.1 (dev only) - Accessibility testing

**Shadcn UI Components Needed:**
- Button, Card, Input, Select, Table, Avatar, Skeleton, Dialog, Tooltip, Calendar

### File Structure and Locations

[Source: docs/architecture/unified-project-structure.md]

**New Files to Create:**
```
apps/web/src/
├── app/
│   ├── (dashboard)/
│   │   ├── dashboard/
│   │   │   └── page.tsx              # NEW - Main dashboard page
│   │   └── layout.tsx                # NEW - Dashboard layout
│   └── api/
│       └── meetings/
│           ├── route.ts              # NEW - GET/POST meetings
│           └── [id]/
│               └── route.ts          # NEW - GET/PATCH specific meeting
├── components/
│   └── dashboard/
│       ├── MeetingHistory.tsx        # NEW
│       ├── CreateMeetingButton.tsx   # NEW
│       ├── UserProfile.tsx           # NEW
│       ├── Navigation.tsx            # NEW
│       └── MetricsPreview.tsx        # NEW
├── hooks/
│   ├── useMeetings.ts                # NEW
│   └── useMeetingRealtime.ts         # NEW
├── services/
│   └── meetings.ts                   # NEW
└── packages/shared/src/types/
    ├── dashboard.ts                  # NEW
    └── meeting.ts                    # NEW
```

**Existing Files to Use:**
- apps/web/src/lib/supabase/client.ts (Supabase client)
- apps/web/src/lib/supabase/server.ts (Server-side Supabase)
- apps/web/src/lib/api-client.ts (API client with auth)
- apps/web/src/middleware.ts (Protected routes)
- packages/shared/src/types/auth.ts (User types)

### Coding Standards Compliance

[Source: docs/architecture/coding-standards.md]

**Critical Rules for This Story:**
- ✅ **Type Sharing:** Define all types in packages/shared/src/types/ and import
- ✅ **API Calls:** Use service layer (services/meetings.ts), never direct HTTP calls in components
- ✅ **Environment Variables:** Access through config objects (lib/config/env.ts)
- ✅ **Error Handling:** All API routes use try-catch with standard error format
- ✅ **State Management:** Use @tanstack/react-query for data fetching, never mutate state directly

**Naming Conventions:**
- Components: PascalCase (MeetingHistory.tsx)
- Hooks: camelCase with 'use' prefix (useMeetings.ts)
- API Routes: kebab-case (/api/meetings)
- Database Tables: snake_case (meetings, participants)

### Security Requirements

[Source: docs/architecture/backend-architecture.md + Story 1.3]

**Authentication Flow:**
1. Clerk middleware at apps/web/src/middleware.ts protects /dashboard routes
2. API routes validate JWT using auth() from @clerk/nextjs
3. Supabase queries use service role key on server, RLS handles security
4. User's clerk_id mapped to database users.id for queries

**Input Validation:**
- Use Zod schemas for all API request validation
- Sanitize user inputs with sanitize-html (already configured from Story 1.2)
- Validate meeting title length (min 1, max 200 characters)
- Validate optional description field

**Rate Limiting:**
- Already configured in Story 1.2 with @upstash/ratelimit
- Apply rate limiting to POST /api/meetings (max 10 meetings per minute per user)

### Performance Optimization

**Dashboard Loading Performance:**
- Use Shadcn Skeleton components for loading states
- Implement React Query staleTime (30 seconds) to reduce unnecessary refetches
- Use Next.js dynamic imports for heavy components (Recharts for metrics)
- Optimize Realtime subscriptions by unsubscribing on unmount

**Bundle Size Considerations:**
- Keep dashboard bundle <200KB (target from architecture)
- Use tree-shaking for date-fns (import only needed functions)
- Lazy load metrics preview component (preparing for Epic 4)

### Accessibility Requirements

[Source: Story 1.5 AC #8]

**WCAG 2.1 AA Compliance:**
- Proper semantic HTML (nav, main, article elements)
- ARIA labels for interactive elements
- Keyboard navigation support (Tab, Enter, Escape)
- Focus visible styles for all interactive elements
- Screen reader friendly status updates
- Color contrast ratios meet AA standards (navy/teal palette)

**react-axe Integration:**
```typescript
// app/layout.tsx (development only)
if (process.env.NODE_ENV === 'development') {
  import('react-axe').then((axe) => {
    axe.default(React, ReactDOM, 1000);
  });
}
```

### Error Handling and User Feedback

**Toast Notifications:**
- Success: "Meeting created successfully!"
- Error: "Failed to create meeting. Please try again."
- Network error: "Connection lost. Retrying..."
- Realtime error: "Live updates unavailable. Please refresh."

**Error Boundaries:**
- Wrap dashboard components in ErrorBoundary
- Provide fallback UI with refresh option
- Log errors to Sentry (configured in Story 1.6)

**Loading States:**
- Skeleton loaders for meeting cards while fetching
- Button loading spinners during meeting creation
- Connection status indicator for Realtime

## Testing

[Source: docs/architecture/testing-strategy.md]

### Test Requirements

**Test Location:** `tests/pages/` for page tests, `tests/components/dashboard/` for component tests, `tests/api/meetings/` for API tests

**Test Framework:** Jest + @testing-library/react for frontend, Jest + supertest for API routes

### Test Structure

```
tests/
├── pages/
│   └── dashboard.test.tsx            # Dashboard page integration test
├── components/
│   └── dashboard/
│       ├── MeetingHistory.test.tsx   # Meeting list component test
│       ├── CreateMeetingButton.test.tsx  # Quick create button test
│       ├── UserProfile.test.tsx      # User profile section test
│       └── Navigation.test.tsx       # Navigation menu test
├── hooks/
│   ├── useMeetings.test.ts           # React Query hook test
│   └── useMeetingRealtime.test.ts    # Realtime subscription test
├── api/
│   └── meetings/
│       └── route.test.ts             # API route test (GET/POST)
└── services/
    └── meetings.test.ts              # Meeting service layer test
```

### Key Test Scenarios

1. **Dashboard Page Rendering**
   - Dashboard page loads successfully
   - User profile section displays authenticated user data
   - Meeting history renders with mock data
   - Navigation menu displays with correct links
   - Loading states show during data fetch
   - Error states display when API fails

2. **Meeting History Component**
   - Displays list of meetings from API
   - Search input filters meetings by title
   - Status filter dropdown filters by meeting status
   - Date range filter works correctly
   - Empty state shows when no meetings
   - Realtime updates trigger UI refresh

3. **Quick Meeting Creation**
   - "Start Meeting" button triggers modal
   - Modal allows optional title/description input
   - Creates meeting on form submission
   - Shows loading spinner during creation
   - Displays toast notification on success
   - Redirects to meeting room after creation
   - Handles API errors gracefully

4. **Navigation and Keyboard Shortcuts**
   - Navigation menu highlights active route
   - Keyboard shortcuts work (Ctrl+D, Ctrl+N, Ctrl+M)
   - Mobile menu opens/closes correctly
   - Tooltips display keyboard shortcut hints

5. **API Route Testing**
   - POST /api/meetings creates meeting with valid data
   - Returns 401 for unauthenticated requests
   - Returns 400 for invalid input
   - GET /api/meetings returns user's meetings only
   - RLS policies enforced (user can't see other users' meetings)

6. **Realtime Subscription**
   - Subscribes to meetings channel on mount
   - Updates meeting list when new meeting created
   - Updates meeting status when changed in database
   - Unsubscribes on component unmount
   - Handles connection errors with retry

7. **Accessibility Testing**
   - All interactive elements have ARIA labels
   - Keyboard navigation works correctly
   - Focus visible on all interactive elements
   - Screen reader announcements for status updates
   - react-axe reports no violations

### Test Performance Requirements
- Dashboard page tests complete within 5 seconds
- Component tests run in under 3 seconds
- API route tests complete within 2 seconds
- Mock Supabase and Clerk for faster test execution

### Test Data Management
- Use MSW (Mock Service Worker) for API mocking
- Mock Supabase client responses
- Mock Clerk auth context with test user
- Use react-query testing utilities for cache management

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-03 | 1.0 | Initial story creation for basic dashboard with meeting management | Bob (Scrum Master) |
| 2025-10-03 | 1.1 | Enhanced with UI/UX wireframes and design specifications from front-end-spec.md | Sarah (Product Owner) |

## Dev Agent Record

### Agent Model Used
_To be filled by Dev Agent_

### Debug Log References
_To be filled by Dev Agent_

### Completion Notes List
_To be filled by Dev Agent_

### File List
_To be filled by Dev Agent_

## QA Results

_To be filled by QA Agent_
